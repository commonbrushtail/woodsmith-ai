---
phase: 06-variation-admin-ui
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/admin/AdminSidebar.jsx
  - src/app/(admin)/admin/variations/page.jsx
  - src/components/admin/VariationsListClient.jsx
autonomous: true

must_haves:
  truths:
    - "Admin can navigate to variations section via sidebar menu"
    - "Admin can see a list of all variation groups with name, entry count, and product count"
    - "Admin can click a group row to navigate to its edit page"
    - "Admin can click 'Create new entry' button to navigate to create page"
  artifacts:
    - path: "src/components/admin/AdminSidebar.jsx"
      provides: "Variations navigation entry in content menu"
      contains: "/admin/variations"
    - path: "src/app/(admin)/admin/variations/page.jsx"
      provides: "Server component list page fetching variation groups"
      exports: ["default"]
    - path: "src/components/admin/VariationsListClient.jsx"
      provides: "Client component rendering variation groups table"
      exports: ["default"]
  key_links:
    - from: "src/components/admin/AdminSidebar.jsx"
      to: "/admin/variations"
      via: "Link href"
      pattern: "href.*admin/variations"
    - from: "src/app/(admin)/admin/variations/page.jsx"
      to: "src/lib/actions/variations.js"
      via: "import getVariationGroups"
      pattern: "getVariationGroups"
    - from: "src/components/admin/VariationsListClient.jsx"
      to: "/admin/variations/create"
      via: "Link href for create button"
      pattern: "admin/variations/create"
    - from: "src/components/admin/VariationsListClient.jsx"
      to: "/admin/variations/edit/"
      via: "Link href and row onClick for edit navigation"
      pattern: "admin/variations/edit"
---

<objective>
Create the variation admin list page with sidebar navigation so admins can browse all variation groups.

Purpose: Establishes the route structure and landing page for the variation management section. Without this, there is no entry point to the variation UI.
Output: Sidebar nav entry + server list page + client list component
</objective>

<execution_context>
@C:/Users/commo/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/commo/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/lib/actions/variations.js
@src/components/admin/AdminSidebar.jsx
@src/components/admin/FaqListClient.jsx
@src/app/(admin)/admin/products/page.jsx
@src/components/admin/ProductsListClient.jsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add variations nav to sidebar and create list page</name>
  <files>
    src/components/admin/AdminSidebar.jsx
    src/app/(admin)/admin/variations/page.jsx
    src/components/admin/VariationsListClient.jsx
  </files>
  <action>
**1. Update AdminSidebar.jsx:**

Add `/admin/variations` to the `iconSidebar` content section paths array (alongside `/admin/products`, etc.).

Add a new item to `contentMenuItems` array AFTER the "สินค้า (Product)" entry:
```js
{ label: 'ตัวเลือกสินค้า (Variations)', path: '/admin/variations' },
```

**2. Create list page server component** at `src/app/(admin)/admin/variations/page.jsx`:

Follow the exact pattern from `src/app/(admin)/admin/products/page.jsx`:
- Import `getVariationGroups` from `@/lib/actions/variations`
- Import `VariationsListClient` from `@/components/admin/VariationsListClient`
- Default async function `VariationsPage` that calls `getVariationGroups()`
- Pass `groups` data to `VariationsListClient` as props
- No `'use client'` — this is a server component

```jsx
import { getVariationGroups } from '@/lib/actions/variations'
import VariationsListClient from '@/components/admin/VariationsListClient'

export default async function VariationsPage() {
  const { data: groups } = await getVariationGroups()
  return <VariationsListClient groups={groups || []} />
}
```

**3. Create VariationsListClient.jsx** at `src/components/admin/VariationsListClient.jsx`:

Follow the FaqListClient.jsx pattern (simpler than ProductsListClient — no pagination needed, no drag-drop on list page). Use `'use client'` directive.

**Header section:**
- Title: `ตัวเลือกสินค้า (Variations)` with count badge showing `groups.length`
- "Create new entry" button (Link to `/admin/variations/create`) styled with orange bg, white text, plus icon — same as FaqListClient and ProductsListClient

**Search bar:**
- Single text input filtering groups by name (client-side filter)
- Placeholder: `ค้นหากลุ่มตัวเลือก...`

**Table:**
- Wrapped in `bg-white rounded-[12px] border border-[#e8eaef]` container (matches FaqListClient)
- Columns: `#` (index), `ชื่อกลุ่ม` (name), `จำนวนตัวเลือก` (entry_count), `สินค้าที่เชื่อมโยง` (product_count), `ACTION`
- Each row is clickable — onClick navigates to `/admin/variations/edit/{group.id}` (same pattern as ProductsListClient row onClick with guard: `if (e.target.closest('button, a, input, select')) return`)
- Name column: Link to `/admin/variations/edit/{group.id}` with hover color transition to orange
- Entry count: plain text showing `group.entry_count`
- Product count: plain text showing `group.product_count`, with `0` shown in muted gray
- ACTION column: 3-dot menu with dropdown containing "แก้ไข" (edit link) and "ลบ" (delete button)

**Delete handler:**
- Import `deleteVariationGroup` from `@/lib/actions/variations`
- Import `useToast` from `@/lib/toast-context`
- On delete click: first call `deleteVariationGroup(id)` without force flag
- If response has `warning: true`, show `confirm()` dialog with message: `${result.message} ต้องการลบหรือไม่?`
- If user confirms: call `deleteVariationGroup(id, { force: true })`
- If error: show toast.error
- After successful delete: call `router.refresh()`

**Empty state:**
- If no groups: show centered text `ยังไม่มีกลุ่มตัวเลือก` in the table body

**Styling requirements (match existing admin list components exactly):**
- `font-['IBM_Plex_Sans_Thai']` on all text elements
- Table header: `bg-[#f9fafb]` or matching border-b pattern from FaqListClient
- Row hover: `hover:bg-[#f9fafb]` or `hover:bg-[#fafafa]`
- 3-dot menu: absolute positioned dropdown with fixed backdrop overlay for closing
- Use inline SVG icon helper functions (PlusIcon, DotsIcon, EditIcon, TrashIcon) — define them locally in the file, same pattern as ProductsListClient and FaqListClient
- Use `useTransition` for pending state with `opacity-60 pointer-events-none` on container
  </action>
  <verify>
Run `npm run build` — must pass with no errors. Verify the three files exist:
- `src/components/admin/AdminSidebar.jsx` contains `/admin/variations`
- `src/app/(admin)/admin/variations/page.jsx` exists and imports getVariationGroups
- `src/components/admin/VariationsListClient.jsx` exists and exports default function
  </verify>
  <done>
Admin can navigate to /admin/variations from sidebar, sees a table of variation groups with name/entry count/product count columns, can click rows to navigate to edit, can click create button, and can delete groups with force-delete confirmation for linked groups.
  </done>
</task>

</tasks>

<verification>
- `npm run build` passes with no errors
- AdminSidebar.jsx contains `/admin/variations` in both iconSidebar paths and contentMenuItems
- VariationsListClient uses `deleteVariationGroup` with the two-step force-delete flow
- All three files follow existing codebase patterns (server component for page, client component for interactivity)
</verification>

<success_criteria>
1. Build passes
2. Sidebar shows "ตัวเลือกสินค้า (Variations)" menu item under content section
3. /admin/variations route renders a table of variation groups
4. Table shows name, entry count, and product count columns
5. Rows are clickable for edit navigation
6. Create button links to /admin/variations/create
7. Delete action handles the warning flow for groups linked to products
</success_criteria>

<output>
After completion, create `.planning/phases/06-variation-admin-ui/06-01-SUMMARY.md`
</output>
