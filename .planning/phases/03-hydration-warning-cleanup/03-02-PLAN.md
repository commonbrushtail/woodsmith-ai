---
phase: 03-hydration-warning-cleanup
plan: 02
type: tdd
wave: 2
depends_on:
  - 03-01
files_modified:
  - tests/components/banners-list-client.test.jsx
  - tests/components/video-highlights-list-client.test.jsx
  - tests/components/gallery-list-client.test.jsx
  - tests/components/manuals-list-client.test.jsx
  - tests/components/faq-list-client.test.jsx
autonomous: true

must_haves:
  truths:
    - "Each of the 5 ListClient components has dedicated test coverage"
    - "Tests verify no hydration warnings in console output"
    - "Tests verify drag-and-drop functionality still works"
  artifacts:
    - path: "tests/components/banners-list-client.test.jsx"
      provides: "Test coverage for BannersListClient hydration fix"
    - path: "tests/components/video-highlights-list-client.test.jsx"
      provides: "Test coverage for VideoHighlightsListClient hydration fix"
    - path: "tests/components/gallery-list-client.test.jsx"
      provides: "Test coverage for GalleryListClient hydration fix"
    - path: "tests/components/manuals-list-client.test.jsx"
      provides: "Test coverage for ManualsListClient hydration fix"
    - path: "tests/components/faq-list-client.test.jsx"
      provides: "Test coverage for FaqListClient hydration fix"
  key_links:
    - from: "ListClient tests"
      to: "ListClient components"
      via: "Each test renders its component and verifies no hydration errors"
---

<objective>
Add comprehensive test coverage for all 5 ListClient components to verify hydration warnings are fixed and drag-and-drop functionality remains intact after refactoring.

Purpose: Ensure BUG-03 fix is thoroughly tested and prevent regressions
Output: 5 new test files with hydration + functional coverage
</objective>

<execution_context>
@C:/Users/commo/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/commo/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/codebase/TESTING.md
@src/components/admin/BannersListClient.jsx
@src/components/admin/VideoHighlightsListClient.jsx
@src/components/admin/GalleryListClient.jsx
@src/components/admin/ManualsListClient.jsx
@src/components/admin/FaqListClient.jsx
</context>

<tasks>
<task type="auto">
  <name>Task 1: Create test for BannersListClient</name>
  <files>tests/components/banners-list-client.test.jsx</files>
  <action>
Create test file for BannersListClient following Vitest + Testing Library patterns.

```javascript
import { describe, it, expect, vi, beforeEach, afterEach } from 'vitest'
import { render, screen } from '@testing-library/react'
import { createElement } from 'react'
import BannersListClient from '@/components/admin/BannersListClient'

// Mock dependencies
vi.mock('next/navigation', () => ({
  useRouter: () => ({
    push: vi.fn(),
    refresh: vi.fn(),
  }),
}))

vi.mock('@/lib/toast-context', () => ({
  useToast: () => ({
    toast: {
      success: vi.fn(),
      error: vi.fn(),
    },
  }),
}))

vi.mock('@/lib/actions/banners', () => ({
  deleteBanner: vi.fn(async () => ({ error: null })),
  toggleBannerStatus: vi.fn(async () => ({ error: null })),
  reorderBanners: vi.fn(async () => ({ error: null })),
}))

describe('BannersListClient', () => {
  let consoleErrorSpy

  beforeEach(() => {
    consoleErrorSpy = vi.spyOn(console, 'error').mockImplementation(() => {})
  })

  afterEach(() => {
    consoleErrorSpy.mockRestore()
  })

  const mockBanners = [
    {
      id: '1',
      image_url: 'https://example.com/banner1.jpg',
      link_url: 'https://example.com',
      status: 'active',
      sort_order: 0,
      created_at: '2024-01-01T00:00:00Z',
    },
    {
      id: '2',
      image_url: 'https://example.com/banner2.jpg',
      link_url: 'https://example.com/page',
      status: 'inactive',
      sort_order: 1,
      created_at: '2024-01-02T00:00:00Z',
    },
  ]

  it('renders without hydration warnings', () => {
    render(createElement(BannersListClient, { banners: mockBanners }))

    // Verify component rendered
    expect(screen.getByText('แบนเนอร์')).toBeInTheDocument()
    expect(screen.getByText('2 entries found')).toBeInTheDocument()

    // CRITICAL: No React hydration warnings
    const hydrationWarnings = consoleErrorSpy.mock.calls.filter(call =>
      call.some(arg =>
        typeof arg === 'string' &&
        (arg.includes('Hydration') ||
         arg.includes('did not match') ||
         arg.includes('Warning: validateDOMNesting'))
      )
    )
    expect(hydrationWarnings).toHaveLength(0)
  })

  it('renders banner items with drag handles', () => {
    render(createElement(BannersListClient, { banners: mockBanners }))

    // Verify drag handles present (aria-label: ลากเพื่อจัดเรียง)
    const dragHandles = screen.getAllByLabelText('ลากเพื่อจัดเรียง')
    expect(dragHandles).toHaveLength(2)
  })

  it('displays banner data correctly', () => {
    render(createElement(BannersListClient, { banners: mockBanners }))

    // Verify images rendered
    const images = screen.getAllByRole('img')
    expect(images).toHaveLength(2)
    expect(images[0]).toHaveAttribute('src', 'https://example.com/banner1.jpg')

    // Verify status badges
    expect(screen.getByText('Showing')).toBeInTheDocument()
    expect(screen.getByText('No Show')).toBeInTheDocument()
  })

  it('renders empty state when no banners', () => {
    render(createElement(BannersListClient, { banners: [] }))

    expect(screen.getByText('ไม่พบข้อมูลแบนเนอร์')).toBeInTheDocument()
  })
})
```
  </action>
  <verify>npm test -- banners-list-client.test.jsx</verify>
  <done>Test passes - BannersListClient renders without hydration warnings</done>
</task>

<task type="auto">
  <name>Task 2: Create test for VideoHighlightsListClient</name>
  <files>tests/components/video-highlights-list-client.test.jsx</files>
  <action>
Create test file for VideoHighlightsListClient.

```javascript
import { describe, it, expect, vi, beforeEach, afterEach } from 'vitest'
import { render, screen } from '@testing-library/react'
import { createElement } from 'react'
import VideoHighlightsListClient from '@/components/admin/VideoHighlightsListClient'

// Mock dependencies
vi.mock('next/navigation', () => ({
  useRouter: () => ({
    push: vi.fn(),
    refresh: vi.fn(),
  }),
}))

vi.mock('@/lib/toast-context', () => ({
  useToast: () => ({
    toast: {
      success: vi.fn(),
      error: vi.fn(),
    },
  }),
}))

vi.mock('@/lib/actions/video-highlights', () => ({
  deleteVideoHighlight: vi.fn(async () => ({ error: null })),
  toggleVideoHighlightPublished: vi.fn(async () => ({ error: null })),
  reorderVideoHighlights: vi.fn(async () => ({ error: null })),
}))

describe('VideoHighlightsListClient', () => {
  let consoleErrorSpy

  beforeEach(() => {
    consoleErrorSpy = vi.spyOn(console, 'error').mockImplementation(() => {})
  })

  afterEach(() => {
    consoleErrorSpy.mockRestore()
  })

  const mockHighlights = [
    {
      id: '1',
      title: 'Test Highlight 1',
      video_url: 'https://youtube.com/watch?v=test1',
      published: true,
      sort_order: 0,
      created_at: '2024-01-01T00:00:00Z',
    },
    {
      id: '2',
      title: 'Test Highlight 2',
      video_url: 'https://youtube.com/watch?v=test2',
      published: false,
      sort_order: 1,
      created_at: '2024-01-02T00:00:00Z',
    },
  ]

  it('renders without hydration warnings', () => {
    render(createElement(VideoHighlightsListClient, {
      highlights: mockHighlights,
      totalCount: 2
    }))

    expect(screen.getByText('วิดีโอไฮไลท์')).toBeInTheDocument()
    expect(screen.getByText('2 entries found')).toBeInTheDocument()

    const hydrationWarnings = consoleErrorSpy.mock.calls.filter(call =>
      call.some(arg =>
        typeof arg === 'string' &&
        (arg.includes('Hydration') ||
         arg.includes('did not match') ||
         arg.includes('Warning: validateDOMNesting'))
      )
    )
    expect(hydrationWarnings).toHaveLength(0)
  })

  it('renders video highlight items with drag handles', () => {
    render(createElement(VideoHighlightsListClient, {
      highlights: mockHighlights,
      totalCount: 2
    }))

    const dragHandles = screen.getAllByLabelText('ลากเพื่อจัดเรียง')
    expect(dragHandles).toHaveLength(2)
  })

  it('displays video highlight data correctly', () => {
    render(createElement(VideoHighlightsListClient, {
      highlights: mockHighlights,
      totalCount: 2
    }))

    expect(screen.getByText('Test Highlight 1')).toBeInTheDocument()
    expect(screen.getByText('Test Highlight 2')).toBeInTheDocument()
    expect(screen.getAllByText('เผยแพร่')).toHaveLength(1)
    expect(screen.getAllByText('ไม่เผยแพร่')).toHaveLength(1)
  })

  it('renders empty state when no highlights', () => {
    render(createElement(VideoHighlightsListClient, {
      highlights: [],
      totalCount: 0
    }))

    expect(screen.getByText('ไม่พบข้อมูลวิดีโอไฮไลท์')).toBeInTheDocument()
  })
})
```
  </action>
  <verify>npm test -- video-highlights-list-client.test.jsx</verify>
  <done>Test passes - VideoHighlightsListClient renders without hydration warnings</done>
</task>

<task type="auto">
  <name>Task 3: Create test for GalleryListClient</name>
  <files>tests/components/gallery-list-client.test.jsx</files>
  <action>
Create test file for GalleryListClient.

```javascript
import { describe, it, expect, vi, beforeEach, afterEach } from 'vitest'
import { render, screen } from '@testing-library/react'
import { createElement } from 'react'
import GalleryListClient from '@/components/admin/GalleryListClient'

// Mock dependencies
vi.mock('next/navigation', () => ({
  useRouter: () => ({
    push: vi.fn(),
    refresh: vi.fn(),
  }),
}))

vi.mock('@/lib/toast-context', () => ({
  useToast: () => ({
    toast: {
      success: vi.fn(),
      error: vi.fn(),
    },
  }),
}))

vi.mock('@/lib/actions/gallery', () => ({
  deleteGalleryItem: vi.fn(async () => ({ error: null })),
  toggleGalleryPublished: vi.fn(async () => ({ error: null })),
  reorderGalleryItems: vi.fn(async () => ({ error: null })),
}))

describe('GalleryListClient', () => {
  let consoleErrorSpy

  beforeEach(() => {
    consoleErrorSpy = vi.spyOn(console, 'error').mockImplementation(() => {})
  })

  afterEach(() => {
    consoleErrorSpy.mockRestore()
  })

  const mockGalleries = [
    {
      id: '1',
      caption: 'Test Gallery 1',
      image_url: 'https://example.com/gallery1.jpg',
      published: true,
      sort_order: 0,
      created_at: '2024-01-01T00:00:00Z',
    },
    {
      id: '2',
      caption: 'Test Gallery 2',
      image_url: 'https://example.com/gallery2.jpg',
      published: false,
      sort_order: 1,
      created_at: '2024-01-02T00:00:00Z',
    },
  ]

  it('renders without hydration warnings', () => {
    render(createElement(GalleryListClient, {
      galleries: mockGalleries,
      totalCount: 2
    }))

    expect(screen.getByText('แกลลอรี่')).toBeInTheDocument()
    expect(screen.getByText('2 entries found')).toBeInTheDocument()

    const hydrationWarnings = consoleErrorSpy.mock.calls.filter(call =>
      call.some(arg =>
        typeof arg === 'string' &&
        (arg.includes('Hydration') ||
         arg.includes('did not match') ||
         arg.includes('Warning: validateDOMNesting'))
      )
    )
    expect(hydrationWarnings).toHaveLength(0)
  })

  it('renders gallery items with drag handles', () => {
    render(createElement(GalleryListClient, {
      galleries: mockGalleries,
      totalCount: 2
    }))

    const dragHandles = screen.getAllByLabelText('ลากเพื่อจัดเรียง')
    expect(dragHandles).toHaveLength(2)
  })

  it('displays gallery data correctly', () => {
    render(createElement(GalleryListClient, {
      galleries: mockGalleries,
      totalCount: 2
    }))

    expect(screen.getByText('Test Gallery 1')).toBeInTheDocument()
    expect(screen.getByText('Test Gallery 2')).toBeInTheDocument()

    const images = screen.getAllByRole('img')
    expect(images).toHaveLength(2)
    expect(images[0]).toHaveAttribute('src', 'https://example.com/gallery1.jpg')
  })

  it('renders empty state when no galleries', () => {
    render(createElement(GalleryListClient, {
      galleries: [],
      totalCount: 0
    }))

    expect(screen.getByText('ไม่พบข้อมูลแกลลอรี่')).toBeInTheDocument()
  })
})
```
  </action>
  <verify>npm test -- gallery-list-client.test.jsx</verify>
  <done>Test passes - GalleryListClient renders without hydration warnings</done>
</task>

<task type="auto">
  <name>Task 4: Create test for ManualsListClient</name>
  <files>tests/components/manuals-list-client.test.jsx</files>
  <action>
Create test file for ManualsListClient.

```javascript
import { describe, it, expect, vi, beforeEach, afterEach } from 'vitest'
import { render, screen } from '@testing-library/react'
import { createElement } from 'react'
import ManualsListClient from '@/components/admin/ManualsListClient'

// Mock dependencies
vi.mock('next/navigation', () => ({
  useRouter: () => ({
    push: vi.fn(),
    refresh: vi.fn(),
  }),
}))

vi.mock('@/lib/toast-context', () => ({
  useToast: () => ({
    toast: {
      success: vi.fn(),
      error: vi.fn(),
    },
  }),
}))

vi.mock('@/lib/actions/manuals', () => ({
  deleteManual: vi.fn(async () => ({ error: null })),
  toggleManualPublished: vi.fn(async () => ({ error: null })),
  reorderManuals: vi.fn(async () => ({ error: null })),
}))

describe('ManualsListClient', () => {
  let consoleErrorSpy

  beforeEach(() => {
    consoleErrorSpy = vi.spyOn(console, 'error').mockImplementation(() => {})
  })

  afterEach(() => {
    consoleErrorSpy.mockRestore()
  })

  const mockManuals = [
    {
      id: '1',
      title: 'Test Manual 1',
      pdf_url: 'https://example.com/manual1.pdf',
      published: true,
      sort_order: 0,
      created_at: '2024-01-01T00:00:00Z',
    },
    {
      id: '2',
      title: 'Test Manual 2',
      pdf_url: 'https://example.com/manual2.pdf',
      published: false,
      sort_order: 1,
      created_at: '2024-01-02T00:00:00Z',
    },
  ]

  it('renders without hydration warnings', () => {
    render(createElement(ManualsListClient, {
      manuals: mockManuals,
      totalCount: 2
    }))

    expect(screen.getByText('คู่มือการใช้สินค้า (Manual)')).toBeInTheDocument()
    expect(screen.getByText('2 entries found')).toBeInTheDocument()

    const hydrationWarnings = consoleErrorSpy.mock.calls.filter(call =>
      call.some(arg =>
        typeof arg === 'string' &&
        (arg.includes('Hydration') ||
         arg.includes('did not match') ||
         arg.includes('Warning: validateDOMNesting'))
      )
    )
    expect(hydrationWarnings).toHaveLength(0)
  })

  it('renders manual items with drag handles', () => {
    render(createElement(ManualsListClient, {
      manuals: mockManuals,
      totalCount: 2
    }))

    const dragHandles = screen.getAllByLabelText('ลากเพื่อจัดเรียง')
    expect(dragHandles).toHaveLength(2)
  })

  it('displays manual data correctly', () => {
    render(createElement(ManualsListClient, {
      manuals: mockManuals,
      totalCount: 2
    }))

    expect(screen.getByText('Test Manual 1')).toBeInTheDocument()
    expect(screen.getByText('Test Manual 2')).toBeInTheDocument()
    expect(screen.getAllByText('เผยแพร่')).toHaveLength(1)
    expect(screen.getAllByText('ไม่เผยแพร่')).toHaveLength(1)
  })

  it('renders empty state when no manuals', () => {
    render(createElement(ManualsListClient, {
      manuals: [],
      totalCount: 0
    }))

    expect(screen.getByText('ไม่พบข้อมูลคู่มือ')).toBeInTheDocument()
  })
})
```
  </action>
  <verify>npm test -- manuals-list-client.test.jsx</verify>
  <done>Test passes - ManualsListClient renders without hydration warnings</done>
</task>

<task type="auto">
  <name>Task 5: Create test for FaqListClient</name>
  <files>tests/components/faq-list-client.test.jsx</files>
  <action>
Create test file for FaqListClient.

```javascript
import { describe, it, expect, vi, beforeEach, afterEach } from 'vitest'
import { render, screen } from '@testing-library/react'
import { createElement } from 'react'
import FaqListClient from '@/components/admin/FaqListClient'

// Mock dependencies
vi.mock('next/navigation', () => ({
  useRouter: () => ({
    push: vi.fn(),
    refresh: vi.fn(),
  }),
}))

vi.mock('@/lib/actions/faqs', () => ({
  deleteFaq: vi.fn(async () => ({ error: null })),
  toggleFaqPublished: vi.fn(async () => ({ error: null })),
  reorderFaqs: vi.fn(async () => ({ error: null })),
}))

describe('FaqListClient', () => {
  let consoleErrorSpy

  beforeEach(() => {
    consoleErrorSpy = vi.spyOn(console, 'error').mockImplementation(() => {})
  })

  afterEach(() => {
    consoleErrorSpy.mockRestore()
  })

  const mockFaqs = [
    {
      id: '1',
      question: 'Test Question 1',
      answer: 'Test Answer 1',
      published: true,
      sort_order: 0,
    },
    {
      id: '2',
      question: 'Test Question 2',
      answer: 'Test Answer 2',
      published: false,
      sort_order: 1,
    },
  ]

  it('renders without hydration warnings', () => {
    render(createElement(FaqListClient, {
      faqs: mockFaqs,
      totalCount: 2
    }))

    expect(screen.getByText('คำถามที่พบบ่อย (FAQs)')).toBeInTheDocument()

    const hydrationWarnings = consoleErrorSpy.mock.calls.filter(call =>
      call.some(arg =>
        typeof arg === 'string' &&
        (arg.includes('Hydration') ||
         arg.includes('did not match') ||
         arg.includes('Warning: validateDOMNesting'))
      )
    )
    expect(hydrationWarnings).toHaveLength(0)
  })

  it('renders FAQ items with drag handles', () => {
    render(createElement(FaqListClient, {
      faqs: mockFaqs,
      totalCount: 2
    }))

    const dragHandles = screen.getAllByLabelText('ลากเพื่อจัดเรียง')
    expect(dragHandles).toHaveLength(2)
  })

  it('displays FAQ data correctly', () => {
    render(createElement(FaqListClient, {
      faqs: mockFaqs,
      totalCount: 2
    }))

    expect(screen.getByText('Test Question 1')).toBeInTheDocument()
    expect(screen.getByText('Test Question 2')).toBeInTheDocument()
    expect(screen.getByText('Test Answer 1')).toBeInTheDocument()
    expect(screen.getByText('Test Answer 2')).toBeInTheDocument()

    expect(screen.getByText('Published')).toBeInTheDocument()
    expect(screen.getByText('Draft')).toBeInTheDocument()
  })

  it('renders empty state when no FAQs', () => {
    render(createElement(FaqListClient, {
      faqs: [],
      totalCount: 0
    }))

    expect(screen.getByText('ยังไม่มีคำถาม')).toBeInTheDocument()
  })
})
```
  </action>
  <verify>npm test -- faq-list-client.test.jsx</verify>
  <done>Test passes - FaqListClient renders without hydration warnings</done>
</task>

<task type="auto">
  <name>Task 6: Run full test suite to verify all tests pass</name>
  <files>N/A - verification only</files>
  <action>
Run complete test suite to ensure all new tests pass and no regressions introduced.

```bash
npm test
```

Expected results:
- All 5 new ListClient tests pass (15+ assertions each)
- Previous SortableList test still passes
- All 199 existing tests still pass
- 3 pre-existing validation failures remain unchanged
- Total: ~204 tests (199 + 5 new ListClient tests)
  </action>
  <verify>npm test</verify>
  <done>Test suite passes: ~204 tests total (199 + 5 new), 3 pre-existing failures</done>
</task>

<task type="auto">
  <name>Task 7: Verify production build still succeeds</name>
  <files>N/A - build verification</files>
  <action>
Final check to ensure production build succeeds with all new tests in place.

```bash
npm run build
```

Expected: Build completes successfully with no errors or warnings.
  </action>
  <verify>npm run build</verify>
  <done>Production build succeeds</done>
</task>
</tasks>

<verification>
## Final Checks

1. ✅ All 5 new ListClient test files created and passing
2. ✅ Each test verifies no hydration warnings via console.error spy
3. ✅ Each test verifies drag handles are present (functional check)
4. ✅ Each test includes empty state coverage
5. ✅ Full test suite passes (~204 tests)
6. ✅ Production build succeeds

## Test Coverage Summary

| Component | Test File | Assertions | Status |
|-----------|-----------|------------|--------|
| BannersListClient | banners-list-client.test.jsx | 4 tests | ✅ Pass |
| VideoHighlightsListClient | video-highlights-list-client.test.jsx | 4 tests | ✅ Pass |
| GalleryListClient | gallery-list-client.test.jsx | 4 tests | ✅ Pass |
| ManualsListClient | manuals-list-client.test.jsx | 4 tests | ✅ Pass |
| FaqListClient | faq-list-client.test.jsx | 4 tests | ✅ Pass |

Total new tests: 20 test cases
</verification>

<success_criteria>
## Measurable Completion

1. **Test coverage added**: 5 new test files, 20+ test cases
2. **Hydration verification**: Each test includes console.error spy check
3. **Functional verification**: Each test verifies drag handles present
4. **Regression check**: All 199 existing tests still pass
5. **Build verification**: Production build succeeds
6. **BUG-03 fully tested**: All affected components have dedicated test coverage
</success_criteria>

<output>
After completion, create `.planning/phases/03-hydration-warning-cleanup/03-02-SUMMARY.md` with:

- Test coverage report (5 files, 20 tests)
- Test execution time (should be fast, ~2-5 seconds)
- Any flaky tests encountered and fixes applied
- Final test count (204 total: 199 existing + 5 new ListClient tests)
- Build time comparison (before/after)
</output>
