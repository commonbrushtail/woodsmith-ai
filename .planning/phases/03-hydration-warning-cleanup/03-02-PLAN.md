---
phase: 03-hydration-warning-cleanup
plan: 02
type: tdd
wave: 2
depends_on:
  - 03-01
files_modified:
  - tests/components/banners-list-client.test.jsx
  - tests/components/video-highlights-list-client.test.jsx
  - tests/components/gallery-list-client.test.jsx
  - tests/components/manuals-list-client.test.jsx
  - tests/components/faq-list-client.test.jsx
autonomous: true

must_haves:
  truths:
    - "Each of the 5 ListClient components has dedicated test coverage"
    - "Tests verify no hydration warnings in console output"
    - "Tests verify drag-and-drop functionality still works"
  artifacts:
    - path: "tests/components/banners-list-client.test.jsx"
      provides: "Test coverage for BannersListClient hydration fix"
    - path: "tests/components/video-highlights-list-client.test.jsx"
      provides: "Test coverage for VideoHighlightsListClient hydration fix"
    - path: "tests/components/gallery-list-client.test.jsx"
      provides: "Test coverage for GalleryListClient hydration fix"
    - path: "tests/components/manuals-list-client.test.jsx"
      provides: "Test coverage for ManualsListClient hydration fix"
    - path: "tests/components/faq-list-client.test.jsx"
      provides: "Test coverage for FaqListClient hydration fix"
  key_links:
    - from: "ListClient tests"
      to: "ListClient components"
      via: "Each test renders its component and verifies no hydration errors"
---

<objective>
Add comprehensive test coverage for all 5 ListClient components to verify hydration warnings are fixed and drag-and-drop functionality remains intact after refactoring.

Purpose: Ensure BUG-03 fix is thoroughly tested and prevent regressions
Output: 5 new test files with hydration + functional coverage
</objective>

<execution_context>
@C:/Users/commo/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/commo/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/codebase/TESTING.md
@src/components/admin/BannersListClient.jsx
@src/components/admin/VideoHighlightsListClient.jsx
@src/components/admin/GalleryListClient.jsx
@src/components/admin/ManualsListClient.jsx
@src/components/admin/FaqListClient.jsx
</context>

<tasks>
<task type="auto">
  <name>Task 1: Create tests for BannersListClient, VideoHighlightsListClient, and GalleryListClient</name>
  <files>
    tests/components/banners-list-client.test.jsx
    tests/components/video-highlights-list-client.test.jsx
    tests/components/gallery-list-client.test.jsx
  </files>
  <action>
Create 3 test files following Vitest + Testing Library patterns. Each test file must:
- Mock dependencies (next/navigation, toast-context, relevant actions module)
- Spy on console.error to detect hydration warnings
- Test 4 scenarios: renders without hydration warnings, drag handles present, data displays correctly, empty state

**Pattern for each test file:**

```javascript
import { describe, it, expect, vi, beforeEach, afterEach } from 'vitest'
import { render, screen } from '@testing-library/react'
import { createElement } from 'react'
import ComponentName from '@/components/admin/ComponentName'

// Mock dependencies (next/navigation, toast-context, action module)
vi.mock('next/navigation', () => ({
  useRouter: () => ({ push: vi.fn(), refresh: vi.fn() }),
}))
vi.mock('@/lib/toast-context', () => ({
  useToast: () => ({ toast: { success: vi.fn(), error: vi.fn() } }),
}))
vi.mock('@/lib/actions/<action-module>', () => ({
  // mock all exported action functions
}))

describe('ComponentName', () => {
  let consoleErrorSpy
  beforeEach(() => { consoleErrorSpy = vi.spyOn(console, 'error').mockImplementation(() => {}) })
  afterEach(() => { consoleErrorSpy.mockRestore() })

  it('renders without hydration warnings', () => {
    render(createElement(ComponentName, { /* props */ }))
    const hydrationWarnings = consoleErrorSpy.mock.calls.filter(call =>
      call.some(arg => typeof arg === 'string' &&
        (arg.includes('Hydration') || arg.includes('did not match') || arg.includes('Warning: validateDOMNesting'))
      )
    )
    expect(hydrationWarnings).toHaveLength(0)
  })

  it('renders items with drag handles', () => { /* check aria-label ลากเพื่อจัดเรียง */ })
  it('displays data correctly', () => { /* check text/images/status badges */ })
  it('renders empty state', () => { /* check empty state message */ })
})
```

**Component-specific details:**

1. **BannersListClient** (`banners-list-client.test.jsx`):
   - Props: `{ banners: [...] }` — each banner has: id, image_url, link_url, status ('active'|'inactive'), sort_order, created_at
   - Mock: `@/lib/actions/banners` — deleteBanner, toggleBannerStatus, reorderBanners
   - Header text: 'แบนเนอร์', entry count: '2 entries found'
   - Status badges: 'Showing' / 'No Show'
   - Empty state: 'ไม่พบข้อมูลแบนเนอร์'

2. **VideoHighlightsListClient** (`video-highlights-list-client.test.jsx`):
   - Props: `{ highlights: [...], totalCount: N }` — each highlight has: id, title, video_url, published (bool), sort_order, created_at
   - Mock: `@/lib/actions/video-highlights` — deleteVideoHighlight, toggleVideoHighlightPublished, reorderVideoHighlights
   - Header text: 'วิดีโอไฮไลท์', entry count: '2 entries found'
   - Status badges: 'เผยแพร่' / 'ไม่เผยแพร่'
   - Empty state: 'ไม่พบข้อมูลวิดีโอไฮไลท์'

3. **GalleryListClient** (`gallery-list-client.test.jsx`):
   - Props: `{ galleries: [...], totalCount: N }` — each gallery has: id, caption, image_url, published (bool), sort_order, created_at
   - Mock: `@/lib/actions/gallery` — deleteGalleryItem, toggleGalleryPublished, reorderGalleryItems
   - Header text: 'แกลลอรี่', entry count: '2 entries found'
   - Empty state: 'ไม่พบข้อมูลแกลลอรี่'
  </action>
  <verify>npm test -- banners-list-client.test.jsx video-highlights-list-client.test.jsx gallery-list-client.test.jsx</verify>
  <done>3 test files created and passing — BannersListClient, VideoHighlightsListClient, GalleryListClient all render without hydration warnings</done>
</task>

<task type="auto">
  <name>Task 2: Create tests for ManualsListClient and FaqListClient</name>
  <files>
    tests/components/manuals-list-client.test.jsx
    tests/components/faq-list-client.test.jsx
  </files>
  <action>
Create 2 test files following the same pattern from Task 1.

**Component-specific details:**

1. **ManualsListClient** (`manuals-list-client.test.jsx`):
   - Props: `{ manuals: [...], totalCount: N }` — each manual has: id, title, pdf_url, published (bool), sort_order, created_at
   - Mock: `@/lib/actions/manuals` — deleteManual, toggleManualPublished, reorderManuals
   - Header text: 'คู่มือการใช้สินค้า (Manual)', entry count: '2 entries found'
   - Status badges: 'เผยแพร่' / 'ไม่เผยแพร่'
   - Empty state: 'ไม่พบข้อมูลคู่มือ'

2. **FaqListClient** (`faq-list-client.test.jsx`):
   - Props: `{ faqs: [...], totalCount: N }` — each FAQ has: id, question, answer, published (bool), sort_order
   - Mock: `@/lib/actions/faqs` — deleteFaq, toggleFaqPublished, reorderFaqs
   - NOTE: FaqListClient may NOT use toast-context — check imports before mocking
   - Header text: 'คำถามที่พบบ่อย (FAQs)'
   - Status badges: 'Published' / 'Draft'
   - Empty state: 'ยังไม่มีคำถาม'
  </action>
  <verify>npm test -- manuals-list-client.test.jsx faq-list-client.test.jsx</verify>
  <done>2 test files created and passing — ManualsListClient, FaqListClient render without hydration warnings</done>
</task>

<task type="auto">
  <name>Task 3: Run full test suite and production build</name>
  <files>N/A - verification only</files>
  <action>
1. Run complete test suite to ensure all new tests pass and no regressions:
   ```bash
   npm test
   ```
   Expected: All 5 new ListClient tests pass (20 assertions), plus all existing tests still pass.

2. Run production build:
   ```bash
   npm run build
   ```
   Expected: Build completes successfully with no errors.
  </action>
  <verify>npm test && npm run build</verify>
  <done>Full test suite passes (~220+ tests), production build succeeds, BUG-03 fully tested</done>
</task>
</tasks>

<verification>
## Final Checks

1. All 5 new ListClient test files created and passing
2. Each test verifies no hydration warnings via console.error spy
3. Each test verifies drag handles are present (functional check)
4. Each test includes empty state coverage
5. Full test suite passes (no regressions)
6. Production build succeeds

## Test Coverage Summary

| Component | Test File | Tests | Status |
|-----------|-----------|-------|--------|
| BannersListClient | banners-list-client.test.jsx | 4 | Pass |
| VideoHighlightsListClient | video-highlights-list-client.test.jsx | 4 | Pass |
| GalleryListClient | gallery-list-client.test.jsx | 4 | Pass |
| ManualsListClient | manuals-list-client.test.jsx | 4 | Pass |
| FaqListClient | faq-list-client.test.jsx | 4 | Pass |

Total new tests: 20 test cases
</verification>

<success_criteria>
## Measurable Completion

1. **Test coverage added**: 5 new test files, 20 test cases
2. **Hydration verification**: Each test includes console.error spy check
3. **Functional verification**: Each test verifies drag handles present
4. **Regression check**: All existing tests still pass
5. **Build verification**: Production build succeeds
6. **BUG-03 fully tested**: All affected components have dedicated test coverage
</success_criteria>

<output>
After completion, create `.planning/phases/03-hydration-warning-cleanup/03-02-SUMMARY.md` with:

- Test coverage report (5 files, 20 tests)
- Test execution time
- Any flaky tests encountered and fixes applied
- Final test count
- Build output confirming success
</output>
